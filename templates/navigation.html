<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood-Safe Navigation</title>
    <!-- Use the same head content as your index.html -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style/styles.css') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{{ url_for('static', filename='script/script.js') }}" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
    <style>
        #floodMap {
            height: 500px;
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        .risk-indicator {
            transition: all 0.3s ease;
        }
        .pulse-ring {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            70% { transform: scale(1.3); opacity: 0.1; }
            100% { transform: scale(0.8); opacity: 0; }
        }
        #startSuggestions, #endSuggestions {
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }
        #startSuggestions div, #endSuggestions div {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        #startSuggestions div:hover, #endSuggestions div:hover {
            background-color: #f3f4f6;
        }
        .user-location-marker {
            background: transparent;
            border: none;
        }
        .user-location-marker i {
            filter: drop-shadow(0 0 2px rgba(0,0,0,0.3));
            color: #3b82f6;
        }
        .transport-mode.active {
            background-color: #3b82f6;
            color: white;
        }
        #walkMode {
            display: none !important;
        }
        .route-option {
            cursor: pointer;
            transition: all 0.2s;
        }
        .route-option:hover {
            background-color: #f3f4f6;
        }
        .route-option.selected {
            border-left: 4px solid #3b82f6;
            background-color: #f0f7ff;
        }
        .emergency-icon {
            background-color: white;
            border-radius: 50%;
            padding: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .flood-marker {
            border-radius: 50%;
            border: 2px solid white;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-out {
            animation: fadeOut 0.5s ease-out;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        #mobile-menu {
            display: none;
        }
    
        .form-container {
            max-width: 450px;
            margin: 0 auto;
        }
    
        .bg-flood-pattern {
            background-image: url("{{ url_for('static', filename='img/flood-pattern.png') }}");
            background-size: cover;
            background-position: center;
            position: relative;
        }
    
        .bg-flood-pattern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(246, 59, 131, 0.679);
            z-index: 0;
        }
    
        .form-content {
            position: relative;
            z-index: 1;
        }
    
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
    
        .animate-fade-out {
            animation: fadeOut 0.5s ease-in-out;
        }
    
        /* Chatbot styles */
        #chat-button {
            background: linear-gradient(135deg, #00bcd4, #2196f3, #f63b83);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    
        #chat-button:hover {
            transform: scale(1.05);
        }
    
        #chat-container {
            background: linear-gradient(to bottom right, #e0f7fa, #b2ebf2, #81d4fa);
            border-radius: 16px;
            padding: 20px;
            max-width: 400px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 1000;
        }
    
        #chat-messages {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
    
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
    
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
    
        #chat-messages::-webkit-scrollbar-thumb {
            background-color: #90caf9;
            border-radius: 3px;
        }
    
        .chat-message {
            background-color: #ffffffcc;
            border-radius: 12px;
            padding: 10px 15px;
            margin: 8px 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
    
        .chat-message.user {
            background-color: #d1c4e9;
            align-self: flex-end;
        }
    
        .chat-message.bot {
            background-color: #e1f5fe;
            align-self: flex-start;
        }
    
        /* Turn-by-turn instructions */
        .turn-by-turn-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            max-height: 40vh;
            overflow-y: auto;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .turn-step {
            display: flex;
            padding: 10px 5px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }

        .next-step {
            background: #f5f9ff;
            border-left: 3px solid #4285F4;
            margin: 0 -15px;
            padding: 12px 15px !important;
        }

        .turn-icon {
            font-size: 24px;
            color: #4285F4;
            width: 40px;
            text-align: center;
            margin-right: 12px;
        }

        .turn-details {
            flex: 1;
        }

        .turn-instruction {
            font-weight: 500;
            margin-bottom: 3px;
            color: #333;
        }

        .turn-distance {
            color: #666;
            font-size: 14px;
        }

        .flood-warning {
            color: #EA4335;
            font-size: 13px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Navigation Bar - identical to index.html -->
    <nav class="flex items-center justify-between px-5 py-3 bg-blue-500 text-white shadow-md">
        <a href="{{ url_for('routes.index') }}">
            <img class="w-32 cursor-pointer" src="{{ url_for('static', filename='img/logo.png') }}" alt="Flood Detection & Route Optimization Logo">
        </a>
        <div class="hidden md:flex space-x-6">
            <a href="{{ url_for('routes.index') }}" class="hover:underline">Home</a>
            <a href="{{ url_for('routes.navigation') }}" class="hover:underline">Navigation</a>
            <a href="{{ url_for('routes.data') }}" class="hover:underline">Flood Data</a>
            <a href="{{ url_for('routes.about') }}" class="hover:underline">About</a>
            <a href="{{ url_for('routes.contact') }}" class="hover:underline">Contact</a>
        </div>
        <div class="md:hidden">
            <button onclick="onToggleMenu()" class="text-2xl">&#9776;</button>
        </div>
    </nav>
    
    <!-- Mobile Menu - identical to index.html -->
    <div id="mobile-menu" class="hidden md:hidden bg-blue-500 text-white p-3 shadow-lg space-y-2">
        <a href="{{ url_for('routes.index') }}" class="block px-2 py-1 hover:underline">Home</a>
        <a href="{{ url_for('routes.navigation') }}" class="block px-2 py-1 hover:underline">Navigation</a>
        <a href="{{ url_for('routes.data') }}" class="block px-2 py-1 hover:underline">Flood Data</a>
        <a href="{{ url_for('routes.about') }}" class="block px-2 py-1 hover:underline">About</a>
        <a href="{{ url_for('routes.contact') }}" class="block px-2 py-1 hover:underline">Contact</a>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto p-4 max-w-4xl">
        <h1 class="text-2xl font-bold text-center mb-6">Flood-Safe Route Planner</h1>

        <!-- Flood Alert Banner -->
        <div id="flood-alert" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4 hidden">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium alert-text">
                        Severe flooding reported in your area. Please stay safe and avoid flood-prone routes.
                    </p>
                </div>
            </div>
        </div>

        <!-- Smart Routing Card - ML Integration -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <h2 class="text-xl font-bold mb-3 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                Smart Routing
            </h2>
            <div class="text-sm text-gray-600 mb-4">
                AI-powered route planning that considers current flood data, traffic conditions, and predicted weather changes.
            </div>
            
            <div class="flex items-center mb-4">
                <div class="mr-2 font-medium">Prioritize:</div>
                <div class="flex space-x-2">
                    <button id="priority-fastest" class="px-3 py-1 bg-blue-600 text-white rounded-md text-sm">Fastest</button>
                    <button id="priority-safest" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm">Safest</button>
                    <button id="priority-balanced" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm">Balanced</button>
                </div>
            </div>
            
            <div id="ml-route-stats" class="grid grid-cols-3 gap-4 mb-4">
                <div class="text-center p-2 bg-gray-50 rounded">
                    <div class="text-sm text-gray-600">Estimated Time</div>
                    <div id="ml-route-time" class="font-bold">24 min</div>
                </div>
                <div class="text-center p-2 bg-gray-50 rounded">
                    <div class="text-sm text-gray-600">Distance</div>
                    <div id="ml-route-distance" class="font-bold">5.2 km</div>
                </div>
                <div class="text-center p-2 bg-gray-50 rounded">
                    <div class="text-sm text-gray-600">Safety Score</div>
                    <div id="ml-route-safety" class="font-bold text-yellow-600">7/10</div>
                </div>
            </div>
            
            <div class="text-sm text-gray-600">
                <span class="font-medium">AI Insight:</span>
                <span id="ml-route-insight">This route avoids 3 flood-prone areas and 1 road with heavy traffic. Alternative routes available.</span>
            </div>
        </div>
        
        <!-- Transport Mode Selector -->
        <div class="flex justify-center gap-2 mb-4">
            <button id="driveMode" class="transport-mode active px-4 py-2 rounded-lg border border-gray-300 flex items-center">
                <i class="fas fa-car mr-2"></i> Drive
            </button>
            <button id="walkMode" class="transport-mode px-4 py-2 rounded-lg border border-gray-300 flex items-center">
                <i class="fas fa-walking mr-2"></i> Walk
            </button>
            <button id="motorcycleMode" class="transport-mode px-4 py-2 rounded-lg border border-gray-300 flex items-center">
                <i class="fas fa-motorcycle mr-2"></i> Motorcycle
            </button>
        </div>
        
        <!-- Location Controls -->
        <div class="flex gap-2 mb-6 justify-center">
            <button id="useMyLocation" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 transition flex items-center">
                <i class="fas fa-location-arrow mr-2"></i> Use My Device Location
            </button>
            <button id="showEmergency" class="bg-red-600 text-white px-4 py-2 rounded-lg shadow hover:bg-red-700 transition flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i> Emergency Services
            </button>
        </div>

        <!-- Location Risk Indicator -->
        <div id="locationRiskCard" class="hidden bg-white p-4 rounded-lg shadow-md mb-4 border-l-4">
            <div class="flex items-center">
                <div id="riskIcon" class="text-2xl mr-3"></div>
                <div>
                    <h3 class="font-bold" id="riskTitle">Risk Assessment</h3>
                    <p class="text-sm text-gray-600" id="riskDetails">Checking location safety...</p>
                </div>
            </div>
            <div id="riskHotspots" class="mt-2 hidden">
                <div class="text-xs font-semibold text-gray-500 mb-1">NEARBY FLOODS:</div>
                <div class="space-y-1" id="hotspotList"></div>
            </div>
        </div>

        <!-- Route Input with Autocomplete -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="grid grid-cols-1 gap-4">
                <div>
                    <label for="startInput" class="block font-medium mb-1">Start Location</label>
                    <div class="relative">
                        <input id="startInput" type="text" placeholder="Search place..." 
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <div id="startSuggestions" class="absolute hidden w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg"></div>
                    </div>
                    <div id="startRisk" class="risk-indicator hidden mt-1 text-xs p-2 rounded"></div>
                </div>
                <div>
                    <label for="endInput" class="block font-medium mb-1">Destination</label>
                    <div class="relative">
                        <input id="endInput" type="text" placeholder="Search place..." 
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <div id="endSuggestions" class="absolute hidden w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg"></div>
                    </div>
                    <div id="endRisk" class="risk-indicator hidden mt-1 text-xs p-2 rounded"></div>
                </div>
                <button id="calculateRoute" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-route mr-2"></i> Calculate Safest Route
                </button>
            </div>
        </div>

        <!-- Map Container -->
        <div class="relative mb-8">
            <div id="floodMap"></div>
        </div>
        
        <!-- Route Options -->
        <div id="routeOptions" class="hidden bg-white p-4 rounded-lg shadow-md mb-4">
            <h3 class="font-bold mb-2">Route Options</h3>
            <div id="routeOptionsList" class="space-y-2"></div>
        </div>
        
        <!-- Route Information -->
        <div id="routeInfo" class="bg-white p-4 rounded-lg shadow-md hidden">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold">Route Information</h3>
                <button id="voiceToggle" class="text-blue-600 text-sm flex items-center">
                    <i class="fas fa-volume-up mr-1"></i> Voice Guidance
                </button>
            </div>
            <div class="grid grid-cols-3 gap-4 text-sm mb-3">
                <div>
                    <span class="text-gray-500">Distance:</span>
                    <span id="routeDistance" class="font-medium">-</span>
                </div>
                <div>
                    <span class="text-gray-500">Duration:</span>
                    <span id="routeDuration" class="font-medium">-</span>
                </div>
                <div>
                    <span class="text-gray-500">Flood Risk:</span>
                    <span id="routeRisk" class="font-medium">-</span>
                </div>
            </div>
            <div id="navigationInstructions" class="text-sm space-y-2"></div>
        </div>
        <div id="turnByTurnContainer" class="turn-by-turn-instructions"></div>
    </main>

    <!-- Footer - identical to index.html -->
    <footer class="bg-blue-600 text-white py-4">
        <div class="max-w-4xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <h3 class="text-base font-bold mb-2">About Us</h3>
                    <p class="text-blue-100 text-xs">
                        We provide real-time flood detection and route optimization to ensure safer travel during extreme weather conditions.
                    </p>
                </div>
                <div>
                    <h3 class="text-base font-bold mb-2">Quick Links</h3>
                    <ul class="space-y-0.5 text-xs text-blue-100">
                        <li><a href="{{ url_for('routes.index') }}" class="hover:underline">Home</a></li>
                        <li><a href="{{ url_for('routes.about') }}" class="hover:underline">About Us</a></li>
                        <li><a href="{{ url_for('routes.navigation') }}" class="hover:underline">Navigation</a></li>
                        <li><a href="{{ url_for('routes.data') }}" class="hover:underline">Flood Data</a></li>
                    </ul>
                </div>
                <div class="flex flex-col items-start">
                    <h3 class="text-base font-bold mb-2">Connect With Us</h3>
                    <div class="flex space-x-3 text-lg">
                        <a href="#" class="text-white hover:text-gray-300"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-white hover:text-gray-300"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white hover:text-gray-300"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-white hover:text-gray-300"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-4 text-center text-xs text-blue-100">
                © 2025 FloodSafe Navigation. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='script/flood-detection.js') }}"></script>
    <script src="{{ url_for('static', filename='script/route-optimization.js') }}"></script>
    <script src="{{ url_for('static', filename='script/ml-integration.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Wait until Leaflet and all scripts are loaded
            setTimeout(function() {
                if (typeof FloodMap !== 'undefined' && document.getElementById('floodMap')) {
                    try {
                        const detector = new FloodMap();
                        detector.init();
                    } catch(e) {
                        console.error("Initialization failed:", e);
                    }
                } else {
                    console.log("FloodMap not defined or map element missing");
                }
            }, 100); // Small delay to ensure everything is loaded
        });

        // ====== YOUR ORIGINAL VARIABLES (with 2 critical additions) ======
        let floodMap;
        let floodLayer = L.layerGroup();
        let routeLayer = L.layerGroup();
        let riskRadiusLayer = L.layerGroup();
        let emergencyLayer = L.layerGroup();
        let currentRoute = null;
        let currentLocationMarker;
        let floodCache = new Map();
        let transportMode = 'drive'; // 'drive', 'walk', 'motorcycle'
        let voiceGuidance = false;
        let speechSynthesis = window.speechSynthesis;
        let emergencyData = [];
        let alternativeRoutes = [];
        let selectedRouteIndex = 0;
        let currentStepIndex = 0; // Tracks which step in the route you're on
        let nextTurnMarker = null; // Single marker for next turn indicator

        // Risk levels configuration
        const RISK_LEVELS = {
            low: {
                color: '#10B981',
                icon: 'fa-circle-check',
                title: 'Low Risk'
            },
            moderate: {
                color: '#F59E0B',
                icon: 'fa-triangle-exclamation',
                title: 'Moderate Risk'
            },
            high: {
                color: '#EF4444',
                icon: 'fa-circle-exclamation',
                title: 'High Risk'
            }
        };

        // Emergency service icons
        const EMERGENCY_ICONS = {
            'barangay_hall': { icon: 'fa-landmark', color: '#3B82F6' },
            'police_station': { icon: 'fa-shield-alt', color: '#1D4ED8' },
            'fire_station': { icon: 'fa-fire-extinguisher', color: '#DC2626' },
            'evacuation_center': { icon: 'fa-home', color: '#10B981' }
        };

        // Initialize the map
        function initMap() {
            try {
                // Create map centered on a default location (Biñan, Laguna)
                floodMap = L.map('floodMap').setView([14.3036, 121.0781], 13);

                // Add OpenStreetMap base layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(floodMap);

                // Initialize layer groups
                floodLayer.addTo(floodMap);
                routeLayer.addTo(floodMap);
                riskRadiusLayer.addTo(floodMap);
                emergencyLayer.addTo(floodMap);

                // Add scale control
                L.control.scale().addTo(floodMap);

            } catch (error) {
                console.error("Map initialization error:", error);
                showNotification("Failed to initialize map. Please refresh the page.", "error");
            }
        }

        // Function to check for flood alerts
        async function checkFloodAlerts() {
            try {
                const response = await fetch('/api/flood-data');
                const data = await response.json();
                
                if (!data.nodes || data.nodes.length === 0) return;
                
                // Check for severe flood conditions
                let hasSevereFlood = false;
                let hasWarningFlood = false;
                
                data.nodes.forEach(node => {
                    if (node.flood_status === 'SEVERE' || node.severity === 'HIGH') {
                        hasSevereFlood = true;
                    } else if (node.flood_status === 'WARNING' || node.severity === 'MODERATE') {
                        hasWarningFlood = true;
                    }
                });
                
                const alertElement = document.getElementById('flood-alert');
                const alertText = alertElement.querySelector('.alert-text');
                
                if (hasSevereFlood) {
                    alertElement.classList.remove('hidden', 'bg-yellow-50', 'border-yellow-200', 'text-yellow-700');
                    alertElement.classList.add('bg-red-50', 'border-red-200', 'text-red-700');
                    alertText.textContent = 'Severe flooding reported in your area. Please stay safe and avoid flood-prone routes.';
                } else if (hasWarningFlood) {
                    alertElement.classList.remove('hidden', 'bg-red-50', 'border-red-200', 'text-red-700');
                    alertElement.classList.add('bg-yellow-50', 'border-yellow-200', 'text-yellow-700');
                    alertText.textContent = 'Flood warning in effect. Some areas may experience flooding.';
                } else {
                    alertElement.classList.add('hidden');
                }
            } catch (error) {
                console.error("Error checking flood alerts:", error);
            }
        }
        
        // Check for alerts when page loads and every 30 seconds
        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            checkFloodAlerts();
            setInterval(checkFloodAlerts, 30000);
        });

        // Helper functions
        function debounce(func, timeout = 500) {
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }

        function showNotification(message, type = "info") {
            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 p-3 rounded-md text-white text-sm max-w-xs ${
                type === "error" ? "bg-red-500" :
                type === "warning" ? "bg-yellow-500" :
                type === "success" ? "bg-green-500" :
                "bg-blue-500"
            }`;
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
        }

        function getSeverity(waterLevel) {
            return waterLevel > 70 ? 'high' :
                   waterLevel > 40 ? 'moderate' :
                   'low';
        }

        function getDistance(pos1, pos2) {
            const R = 6371e3;
            const φ1 = pos1.lat * Math.PI/180;
            const φ2 = pos2.latitude * Math.PI/180;
            const Δφ = (pos2.latitude-pos1.lat) * Math.PI/180;
            const Δλ = (pos2.longitude-pos1.lng) * Math.PI/180;

            const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ/2) * Math.sin(Δλ/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return Math.round(R * c);
        }

        // Toggle mobile menu - identical to index.html
        function onToggleMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }
    </script>
</body>
</html>
